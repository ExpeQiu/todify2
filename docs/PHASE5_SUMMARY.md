# é˜¶æ®µ5å®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. é”™è¯¯è¿½è¸ªç³»ç»Ÿ

**æ–‡ä»¶**: `backend/src/shared/infrastructure/monitoring/errorTracking.ts`

**åŠŸèƒ½**:
- âœ… è‡ªåŠ¨æ•è·æœªå¤„ç†çš„å¼‚å¸¸å’Œ Promise æ‹’ç»
- âœ… æ”¯æŒé”™è¯¯ä¸Šä¸‹æ–‡è®°å½•ï¼ˆç”¨æˆ·IDã€ä¼šè¯IDã€è¯·æ±‚IDç­‰ï¼‰
- âœ… æ”¯æŒé”™è¯¯çº§åˆ«åˆ†ç±»ï¼ˆerror, warning, info, fatalï¼‰
- âœ… é¢„ç•™ Sentry é›†æˆæ¥å£ï¼ˆå¯é€‰ï¼‰

**é›†æˆä½ç½®**:
- âœ… `backend/src/index.ts` - åº”ç”¨å¯åŠ¨æ—¶åˆå§‹åŒ–
- âœ… å…¨å±€é”™è¯¯å¤„ç†ä¸­é—´ä»¶ - è‡ªåŠ¨æ•è·æ‰€æœ‰æœªå¤„ç†é”™è¯¯
- âœ… å…³é”®ä¸šåŠ¡é€»è¾‘ - æ‰‹åŠ¨æ•è·é‡è¦é”™è¯¯

### 2. æ€§èƒ½ç›‘æ§ç³»ç»Ÿ

**æ–‡ä»¶**: `backend/src/shared/infrastructure/monitoring/performanceMonitor.ts`

**åŠŸèƒ½**:
- âœ… è‡ªåŠ¨è®°å½•æ‰€æœ‰ HTTP è¯·æ±‚çš„æ€§èƒ½æŒ‡æ ‡
- âœ… æ£€æµ‹æ…¢è¯·æ±‚ï¼ˆ>1ç§’ï¼‰å¹¶è®°å½•
- âœ… æä¾›æ€§èƒ½ç»Ÿè®¡ï¼ˆå¹³å‡å“åº”æ—¶é—´ã€P50/P95/P99ï¼‰
- âœ… API ç«¯ç‚¹: `GET /api/v1/monitoring/performance`

**é›†æˆä½ç½®**:
- âœ… `backend/src/index.ts` - Express ä¸­é—´ä»¶é›†æˆ

### 3. æµ‹è¯•é…ç½®å®Œå–„

**åç«¯æµ‹è¯•**:
- âœ… æ›´æ–° `backend/vitest.config.ts` - é…ç½®è¦†ç›–ç‡é˜ˆå€¼å’ŒæŠ¥å‘Šæ ¼å¼
- âœ… åˆ›å»º `backend/tests/shared/infrastructure/DifyGateway.test.ts` - Dify Gateway æµ‹è¯•
- âœ… åˆ›å»º `backend/tests/shared/types/api.test.ts` - API å“åº”æ ¼å¼æµ‹è¯•
- âœ… åˆ›å»º `backend/tests/shared/infrastructure/performanceMonitor.test.ts` - æ€§èƒ½ç›‘æ§æµ‹è¯•

**å‰ç«¯æµ‹è¯•**:
- âœ… åˆ›å»º `frontend/vitest.config.ts` - å‰ç«¯æµ‹è¯•é…ç½®
- âœ… åˆ›å»º `frontend/src/test/setup.ts` - æµ‹è¯•ç¯å¢ƒè®¾ç½®ï¼ˆMock localStorage, matchMediaï¼‰

**E2E æµ‹è¯•**:
- âœ… åˆ›å»º `frontend/playwright.config.ts` - Playwright é…ç½®
- âœ… åˆ›å»º `frontend/e2e/workflow.spec.ts` - å·¥ä½œæµé¡µé¢ E2E æµ‹è¯•

### 4. CI/CD é…ç½®

**æ–‡ä»¶**: `.github/workflows/ci.yml`

**å·¥ä½œæµ**:
- âœ… **Backend Tests**: è¿è¡Œåç«¯å•å…ƒæµ‹è¯•å’Œç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
- âœ… **Frontend Tests**: è¿è¡Œå‰ç«¯å•å…ƒæµ‹è¯•ã€lint æ£€æŸ¥å’Œç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
- âœ… **Backend Build**: æ„å»ºåç«¯åº”ç”¨
- âœ… **Frontend Build**: æ„å»ºå‰ç«¯åº”ç”¨
- âœ… **E2E Tests**: è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆå¯é€‰ï¼‰

**è§¦å‘æ¡ä»¶**:
- âœ… Push åˆ° `main` æˆ– `develop` åˆ†æ”¯
- âœ… Pull Request åˆ° `main` æˆ– `develop` åˆ†æ”¯

### 5. æ–‡æ¡£

**æ–‡ä»¶**: `docs/MONITORING_AND_TESTING.md`

**å†…å®¹**:
- âœ… ç›‘æ§ä½“ç³»è¯´æ˜ï¼ˆé”™è¯¯è¿½è¸ªã€æ€§èƒ½ç›‘æ§ã€å¥åº·æ£€æŸ¥ï¼‰
- âœ… æµ‹è¯•ä½“ç³»è¯´æ˜ï¼ˆå•å…ƒæµ‹è¯•ã€E2E æµ‹è¯•ï¼‰
- âœ… CI/CD å·¥ä½œæµè¯´æ˜
- âœ… æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡å’ŒæŸ¥çœ‹æ–¹æ³•
- âœ… ç›‘æ§æœ€ä½³å®è·µ
- âœ… ä¸‹ä¸€æ­¥ä¼˜åŒ–å»ºè®®

### 6. è„šæœ¬æ›´æ–°

**åç«¯** (`backend/package.json`):
- âœ… `test:run` - è¿è¡Œæµ‹è¯•ï¼ˆä¸watchï¼‰
- âœ… `test:coverage` - ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š

**å‰ç«¯** (`frontend/package.json`):
- âœ… `test:run` - è¿è¡Œæµ‹è¯•ï¼ˆä¸watchï¼‰
- âœ… `test:coverage` - ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
- âœ… `test:e2e` - è¿è¡Œ E2E æµ‹è¯•
- âœ… `test:e2e:ui` - ä»¥ UI æ¨¡å¼è¿è¡Œ E2E æµ‹è¯•

## ğŸ“Š æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡

| é¡¹ç›® | Lines | Functions | Branches | Statements |
|------|-------|-----------|----------|------------|
| åç«¯ | 70% | 70% | 60% | 70% |
| å‰ç«¯ | 60% | 60% | 50% | 60% |

## ğŸ” ç›‘æ§ç«¯ç‚¹

1. **å¥åº·æ£€æŸ¥**: `GET /api/health`
   - è¿”å›æœåŠ¡å™¨çŠ¶æ€ã€ç‰ˆæœ¬ã€è¿è¡Œæ—¶é—´

2. **æ€§èƒ½ç›‘æ§**: `GET /api/v1/monitoring/performance`
   - è¿”å›æ€§èƒ½ç»Ÿè®¡ï¼ˆå¹³å‡å“åº”æ—¶é—´ã€P50/P95/P99ã€æ…¢è¯·æ±‚åˆ—è¡¨ï¼‰

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®

### å¯é€‰å¢å¼º

1. **Sentry é›†æˆ**:
   ```bash
   npm install @sentry/node @sentry/react
   ```
   - è®¾ç½® `SENTRY_DSN` ç¯å¢ƒå˜é‡
   - å–æ¶ˆæ³¨é‡Š `errorTracking.ts` ä¸­çš„ Sentry ä»£ç 

2. **Prometheus æŒ‡æ ‡å¯¼å‡º**:
   - å®‰è£… `prom-client`
   - æ·»åŠ  `/metrics` ç«¯ç‚¹
   - é…ç½® Grafana ä»ªè¡¨æ¿

3. **æ›´å¤šæµ‹è¯•ç”¨ä¾‹**:
   - ä¸ºå…³é”® UseCase æ·»åŠ å•å…ƒæµ‹è¯•
   - ä¸º React ç»„ä»¶æ·»åŠ æµ‹è¯•
   - æ‰©å±• E2E æµ‹è¯•è¦†ç›–æ›´å¤šåœºæ™¯

4. **ä»£ç è´¨é‡æ£€æŸ¥**:
   - æ·»åŠ  ESLint åˆ° CI/CD
   - æ·»åŠ  Prettier æ ¼å¼åŒ–æ£€æŸ¥
   - æ·»åŠ ç±»å‹æ£€æŸ¥åˆ° CI/CD

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### è¿è¡Œæµ‹è¯•

```bash
# åç«¯æµ‹è¯•
cd backend
npm test              # Watch æ¨¡å¼
npm run test:run      # å•æ¬¡è¿è¡Œ
npm run test:coverage # ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š

# å‰ç«¯æµ‹è¯•
cd frontend
npm test              # Watch æ¨¡å¼
npm run test:run      # å•æ¬¡è¿è¡Œ
npm run test:coverage # ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm run test:e2e      # E2E æµ‹è¯•
```

### æŸ¥çœ‹ç›‘æ§æ•°æ®

```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:3001/api/health

# æ€§èƒ½ç»Ÿè®¡
curl http://localhost:3001/api/v1/monitoring/performance
```

## âœ¨ æ€»ç»“

é˜¶æ®µ5å·²å®Œæˆä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

1. âœ… **é”™è¯¯è¿½è¸ªç³»ç»Ÿ** - è‡ªåŠ¨æ•è·å’Œè®°å½•é”™è¯¯
2. âœ… **æ€§èƒ½ç›‘æ§ç³»ç»Ÿ** - è‡ªåŠ¨è®°å½•è¯·æ±‚æ€§èƒ½æŒ‡æ ‡
3. âœ… **æµ‹è¯•é…ç½®å®Œå–„** - å‰åç«¯æµ‹è¯•ç¯å¢ƒé…ç½®å®Œæˆ
4. âœ… **CI/CD æµæ°´çº¿** - GitHub Actions å·¥ä½œæµé…ç½®å®Œæˆ
5. âœ… **æ–‡æ¡£å®Œå–„** - ç›‘æ§å’Œæµ‹è¯•æ–‡æ¡£ç¼–å†™å®Œæˆ

æ‰€æœ‰ä»£ç å·²é€šè¿‡ lint æ£€æŸ¥ï¼Œå¯ä»¥å¼€å§‹ä½¿ç”¨ã€‚

