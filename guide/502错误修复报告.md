# 502é”™è¯¯ä¿®å¤æŠ¥å‘Š

## é—®é¢˜æè¿°
- **é”™è¯¯ç±»å‹**: 502 Bad Gateway
- **å½±å“æ–‡ä»¶**: favicon.ico å’Œä¸»é¡µèµ„æº
- **æ—¶é—´**: 2025-10-28

## é—®é¢˜åˆ†æ

### æ ¹æœ¬åŸå› 
1. **å‰ç«¯æœåŠ¡æœªç›‘å¬IPv4**: Viteå¼€å‘æœåŠ¡å™¨é»˜è®¤åªç›‘å¬ `localhost` (127.0.0.1)
2. **Nginxä»£ç†å¤±è´¥**: Nginxå°è¯•ä»£ç†åˆ° `127.0.0.1:3001`ï¼Œä½†æœåŠ¡åªç›‘å¬ IPv6
3. **ç«¯å£ç»‘å®šé—®é¢˜**: 3001ç«¯å£åªç»‘å®šäº† `::1` (IPv6 localhost)ï¼Œæœªç»‘å®š `0.0.0.0` (IPv4)

### è¯Šæ–­æ­¥éª¤

#### 1. æ£€æŸ¥æœåŠ¡è¿›ç¨‹çŠ¶æ€
```bash
ps aux | grep -E 'node|nginx|vite'
```
**ç»“æœ**: åç«¯æœåŠ¡è¿è¡Œæ­£å¸¸ï¼Œä½†å‰ç«¯æœåŠ¡æœªå¯åŠ¨

#### 2. æ£€æŸ¥ç«¯å£ç›‘å¬
```bash
netstat -tulnp | grep -E ':(3001|3003|8088)'
```
**åŸå§‹çŠ¶æ€**:
```
tcp        0      0 0.0.0.0:8088            0.0.0.0:*               LISTEN
tcp        0      0 0.0.0.0:3003            0.0.0.0:*               LISTEN
tcp6       0      0 ::1:3001                :::*                    LISTEN  â† é—®é¢˜åœ¨è¿™é‡Œ
```

**é—®é¢˜**: 3001ç«¯å£åªç›‘å¬IPv6 (::1)ï¼Œä¸ç›‘å¬IPv4

#### 3. æ£€æŸ¥Nginxé…ç½®
```bash
cat /etc/nginx/conf.d/todify2.conf
```
**é…ç½®å†…å®¹**:
```nginx
server {
    listen 8088;
    server_name 47.113.225.93;

    # å‰ç«¯ä»£ç†åˆ°3001ç«¯å£
    location / {
        proxy_pass http://127.0.0.1:3001;
        # ...
    }
}
```

**é…ç½®æ­£ç¡®**: Nginxå°è¯•ä»£ç†åˆ° `127.0.0.1:3001`ï¼Œä½†å‰ç«¯æœåŠ¡æœªç›‘å¬è¯¥åœ°å€

## è§£å†³æ–¹æ¡ˆ

### 1. å®‰è£…å‰ç«¯ä¾èµ–
```bash
cd /root/frontend
npm install
```
**ç»“æœ**: å®‰è£…äº†456ä¸ªåŒ…

### 2. å¯åŠ¨å‰ç«¯æœåŠ¡å¹¶ç›‘å¬æ‰€æœ‰æ¥å£
```bash
cd /root/frontend
npm run dev -- --host 0.0.0.0
```

**å…³é”®ä¿®æ”¹**: æ·»åŠ  `--host 0.0.0.0` å‚æ•°

#### å¯åŠ¨å‰ (é”™è¯¯çŠ¶æ€)
```
âœ  Local:   http://localhost:3001/
[åªç›‘å¬ ::1]
```

#### å¯åŠ¨å (ä¿®å¤å)
```
âœ  Local:   http://localhost:3001/
âœ  Network: http://172.22.235.145:3001/
âœ  Network: http://172.25.0.1:3001/
âœ  Network: http://172.26.0.1:3001/
```

### 3. éªŒè¯ä¿®å¤

**ç«¯å£ç›‘å¬çŠ¶æ€**:
```
tcp        0      0 0.0.0.0:3001            0.0.0.0:*               LISTEN  âœ“
tcp        0      0 0.0.0.0:3003            0.0.0.0:*               LISTEN  âœ“
tcp        0      0 0.0.0.0:8088            0.0.0.0:*               LISTEN  âœ“
```

**æµ‹è¯•è®¿é—®**:
```bash
curl http://47.113.225.93:8088/
```
**ç»“æœ**: HTMLé¡µé¢æ­£å¸¸è¿”å› âœ…

**æµ‹è¯•API**:
```bash
curl http://47.113.225.93:8088/api/health
```
**ç»“æœ**: 
```json
{
  "message": "Todify3 Backend API",
  "version": "1.0.0",
  "status": "running"
}
```
âœ…

**æµ‹è¯•favicon**:
```bash
curl -I http://47.113.225.93:8088/favicon.ico
```
**ç»“æœ**: 404ï¼ˆæ­£å¸¸ï¼Œå› ä¸ºæœªé…ç½®faviconï¼‰

## ä¿®å¤æ€»ç»“

### æˆåŠŸä¿®å¤çš„é—®é¢˜
- âœ… 502 Bad Gateway é”™è¯¯å·²è§£å†³
- âœ… å‰ç«¯æœåŠ¡æ­£å¸¸ç›‘å¬IPv4
- âœ… Nginxä»£ç†æ­£å¸¸å·¥ä½œ
- âœ… APIè¯·æ±‚æ­£å¸¸å“åº”

### å…³é”®ä¿®å¤ç‚¹

#### 1. Viteå¼€å‘æœåŠ¡å™¨é…ç½®
**é—®é¢˜**: Viteé»˜è®¤åªç›‘å¬localhost
**è§£å†³**: å¯åŠ¨æ—¶æ·»åŠ  `--host 0.0.0.0` å‚æ•°

#### 2. ç«¯å£ç»‘å®š
**é—®é¢˜**: æœåŠ¡åªç»‘å®šIPv6
**è§£å†³**: ç»‘å®šæ‰€æœ‰ç½‘ç»œæ¥å£ (0.0.0.0)

#### 3. æœåŠ¡å¯åŠ¨é¡ºåº
- ç¡®ä¿ä¾èµ–å·²å®‰è£…
- ç¡®ä¿æœåŠ¡ç›‘å¬æ­£ç¡®ç«¯å£
- ç¡®ä¿Nginxé…ç½®æ­£ç¡®

### æœåŠ¡æ¶æ„

```
ç”¨æˆ·è¯·æ±‚ (47.113.225.93:8088)
    â†“
Nginx (8088ç«¯å£)
    â†“
å‰ç«¯ (3001ç«¯å£) â† å¿…é¡»ç›‘å¬ 0.0.0.0
åç«¯ (3003ç«¯å£) â† å¿…é¡»ç›‘å¬ 0.0.0.0
```

### éªŒè¯æ¸…å•

- [x] å‰ç«¯æœåŠ¡è¿è¡Œæ­£å¸¸
- [x] å‰ç«¯æœåŠ¡ç›‘å¬IPv4 (0.0.0.0)
- [x] åç«¯æœåŠ¡è¿è¡Œæ­£å¸¸
- [x] Nginxé…ç½®æ­£ç¡®
- [x] é¡µé¢å¯æ­£å¸¸è®¿é—®
- [x] APIæ­£å¸¸å“åº”
- [x] æ— 502é”™è¯¯

## å½“å‰æœåŠ¡çŠ¶æ€

### ç«¯å£ç›‘å¬
```
8088: Nginx ä»£ç† (ç›‘å¬æ‰€æœ‰æ¥å£)
3001: å‰ç«¯æœåŠ¡ (ç›‘å¬æ‰€æœ‰æ¥å£)
3003: åç«¯æœåŠ¡ (ç›‘å¬æ‰€æœ‰æ¥å£)
```

### æœåŠ¡è¿›ç¨‹
```bash
root     715005   nginx: master process
nginx    715006   nginx: worker process
root     3664522  node dist/index.js (åç«¯)
root     3683996  node (å‰ç«¯ Vite)
```

### å¯åŠ¨å‘½ä»¤
**åç«¯**:
```bash
cd /root/backend
PORT=3003 node dist/index.js > backend.log 2>&1 &
```

**å‰ç«¯**:
```bash
cd /root/frontend
npm run dev -- --host 0.0.0.0 > frontend.log 2>&1 &
```

## é¢„é˜²æªæ–½

### 1. å‰ç«¯å¯åŠ¨è„šæœ¬
å»ºè®®åˆ›å»ºä¸€ä¸ªå¯åŠ¨è„šæœ¬ `start-frontend.sh`:
```bash
#!/bin/bash
cd /root/frontend
npm run dev -- --host 0.0.0.0 > frontend.log 2>&1 &
```

### 2. åç«¯å¯åŠ¨è„šæœ¬
å»ºè®®åˆ›å»ºä¸€ä¸ªå¯åŠ¨è„šæœ¬ `start-backend.sh`:
```bash
#!/bin/bash
cd /root/backend
PORT=3003 node dist/index.js > backend.log 2>&1 &
```

### 3. ç›‘æ§è„šæœ¬
åˆ›å»º `check-services.sh`:
```bash
#!/bin/bash
echo "=== æœåŠ¡çŠ¶æ€ ==="
netstat -tulnp | grep -E ':(3001|3003|8088)'
echo ""
echo "=== è¿›ç¨‹çŠ¶æ€ ==="
ps aux | grep -E 'node|nginx' | grep -v grep
```

### 4. è‡ªåŠ¨å¯åŠ¨
å»ºè®®ä½¿ç”¨ systemd æˆ– pm2 ç®¡ç†æœåŠ¡:
```bash
# ä½¿ç”¨ pm2
npm install -g pm2
pm2 start npm --name "frontend" -- run dev -- --host 0.0.0.0
pm2 start "node dist/index.js" --name "backend" -- PORT=3003
pm2 startup
pm2 save
```

## ç”¨æˆ·æ“ä½œæŒ‡å—

### æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
502é”™è¯¯å¯èƒ½æ˜¯ç”±äºæµè§ˆå™¨ç¼“å­˜å¯¼è‡´çš„ï¼Œè¯·æ‰§è¡Œï¼š

**å¼ºåˆ¶åˆ·æ–°**:
- Windows: `Ctrl + Shift + R`
- Mac: `Cmd + Shift + R`

**æ¸…é™¤localStorage**:
```javascript
localStorage.clear();
location.reload();
```

### éªŒè¯ä¿®å¤
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)
2. æ£€æŸ¥Networkæ ‡ç­¾
3. ç¡®è®¤æ— 502é”™è¯¯
4. ç¡®è®¤é¡µé¢æ­£å¸¸åŠ è½½

## æ€»ç»“

âœ… **502é”™è¯¯å·²å®Œå…¨ä¿®å¤**
- å‰ç«¯æœåŠ¡æ­£å¸¸è¿è¡Œ
- ç«¯å£ç»‘å®šæ­£ç¡®
- Nginxä»£ç†æ­£å¸¸å·¥ä½œ
- æ‰€æœ‰æœåŠ¡ç›‘å¬æ­£ç¡®æ¥å£

ğŸ¯ **å…³é”®æ”¹è¿›**
- ä½¿ç”¨ `--host 0.0.0.0` å¯åŠ¨å‰ç«¯
- ç¡®ä¿æœåŠ¡ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£
- éªŒè¯ç«¯å£å’Œä»£ç†é…ç½®

ğŸ“‹ **ä¸‹ä¸€æ­¥å»ºè®®**
- é…ç½®è‡ªåŠ¨å¯åŠ¨è„šæœ¬
- ä½¿ç”¨è¿›ç¨‹ç®¡ç†å™¨ (pm2)
- è®¾ç½®æœåŠ¡ç›‘æ§
- å®šæœŸæ£€æŸ¥æœåŠ¡çŠ¶æ€

