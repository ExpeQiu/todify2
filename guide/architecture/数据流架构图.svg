<svg width="1200" height="800" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font-family: Arial, sans-serif; font-size: 24px; font-weight: bold; fill: #2c3e50; }
      .subtitle { font-family: Arial, sans-serif; font-size: 16px; font-weight: bold; fill: #34495e; }
      .text { font-family: Arial, sans-serif; font-size: 12px; fill: #2c3e50; }
      .small-text { font-family: Arial, sans-serif; font-size: 10px; fill: #7f8c8d; }
      .frontend { fill: #3498db; stroke: #2980b9; stroke-width: 2; }
      .backend { fill: #e74c3c; stroke: #c0392b; stroke-width: 2; }
      .database { fill: #f39c12; stroke: #e67e22; stroke-width: 2; }
      .external { fill: #9b59b6; stroke: #8e44ad; stroke-width: 2; }
      .service { fill: #2ecc71; stroke: #27ae60; stroke-width: 2; }
      .arrow { stroke: #34495e; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .data-flow { stroke: #e67e22; stroke-width: 3; fill: none; marker-end: url(#datahead); stroke-dasharray: 5,5; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#34495e" />
    </marker>
    <marker id="datahead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#e67e22" />
    </marker>
  </defs>
  
  <!-- 标题 -->
  <text x="600" y="30" text-anchor="middle" class="title">Todify 数据流架构图</text>
  
  <!-- 前端层 -->
  <g id="frontend-layer">
    <text x="100" y="80" class="subtitle">前端层 (Frontend)</text>
    
    <!-- React 应用 -->
    <rect x="50" y="100" width="200" height="80" rx="10" class="frontend"/>
    <text x="150" y="125" text-anchor="middle" class="text">React SPA</text>
    <text x="150" y="140" text-anchor="middle" class="small-text">• 用户界面</text>
    <text x="150" y="155" text-anchor="middle" class="small-text">• 表单验证</text>
    <text x="150" y="170" text-anchor="middle" class="small-text">• 状态管理</text>
    
    <!-- API 客户端 -->
    <rect x="300" y="100" width="150" height="80" rx="10" class="frontend"/>
    <text x="375" y="125" text-anchor="middle" class="text">API Client</text>
    <text x="375" y="140" text-anchor="middle" class="small-text">• HTTP 请求</text>
    <text x="375" y="155" text-anchor="middle" class="small-text">• 流式连接</text>
    <text x="375" y="170" text-anchor="middle" class="small-text">• 错误处理</text>
  </g>
  
  <!-- 后端层 -->
  <g id="backend-layer">
    <text x="100" y="250" class="subtitle">后端层 (Backend)</text>
    
    <!-- Express 服务器 -->
    <rect x="50" y="270" width="150" height="80" rx="10" class="backend"/>
    <text x="125" y="295" text-anchor="middle" class="text">Express Server</text>
    <text x="125" y="310" text-anchor="middle" class="small-text">• 路由管理</text>
    <text x="125" y="325" text-anchor="middle" class="small-text">• 中间件</text>
    <text x="125" y="340" text-anchor="middle" class="small-text">• 错误处理</text>
    
    <!-- API 路由 -->
    <rect x="250" y="270" width="120" height="80" rx="10" class="backend"/>
    <text x="310" y="295" text-anchor="middle" class="text">API Routes</text>
    <text x="310" y="310" text-anchor="middle" class="small-text">• /tasks</text>
    <text x="310" y="325" text-anchor="middle" class="small-text">• /workflows</text>
    <text x="310" y="340" text-anchor="middle" class="small-text">• /results</text>
    
    <!-- 工作流服务 -->
    <rect x="420" y="270" width="150" height="80" rx="10" class="service"/>
    <text x="495" y="295" text-anchor="middle" class="text">WorkflowService</text>
    <text x="495" y="310" text-anchor="middle" class="small-text">• 任务执行</text>
    <text x="495" y="325" text-anchor="middle" class="small-text">• 状态管理</text>
    <text x="495" y="340" text-anchor="middle" class="small-text">• 结果处理</text>
  </g>
  
  <!-- 服务层 -->
  <g id="service-layer">
    <text x="100" y="420" class="subtitle">服务层 (Services)</text>
    
    <!-- 字段映射服务 -->
    <rect x="50" y="440" width="130" height="60" rx="10" class="service"/>
    <text x="115" y="465" text-anchor="middle" class="text">FieldMapping</text>
    <text x="115" y="480" text-anchor="middle" class="small-text">字段映射</text>
    
    <!-- 验证服务 -->
    <rect x="200" y="440" width="130" height="60" rx="10" class="service"/>
    <text x="265" y="465" text-anchor="middle" class="text">Validation</text>
    <text x="265" y="480" text-anchor="middle" class="small-text">数据验证</text>
    
    <!-- 缓存服务 -->
    <rect x="350" y="440" width="130" height="60" rx="10" class="service"/>
    <text x="415" y="465" text-anchor="middle" class="text">Cache</text>
    <text x="415" y="480" text-anchor="middle" class="small-text">缓存管理</text>
    
    <!-- Dify 客户端 -->
    <rect x="500" y="440" width="130" height="60" rx="10" class="service"/>
    <text x="565" y="465" text-anchor="middle" class="text">DifyClient</text>
    <text x="565" y="480" text-anchor="middle" class="small-text">外部调用</text>
  </g>
  
  <!-- 数据层 -->
  <g id="data-layer">
    <text x="100" y="570" class="subtitle">数据层 (Data)</text>
    
    <!-- SQLite 数据库 -->
    <rect x="50" y="590" width="200" height="100" rx="10" class="database"/>
    <text x="150" y="615" text-anchor="middle" class="text">SQLite Database</text>
    <text x="150" y="635" text-anchor="middle" class="small-text">• Task (任务)</text>
    <text x="150" y="650" text-anchor="middle" class="small-text">• TaskResult (结果)</text>
    <text x="150" y="665" text-anchor="middle" class="small-text">• ContentPage (内容)</text>
    <text x="150" y="680" text-anchor="middle" class="small-text">• WorkflowDefinition</text>
    
    <!-- Prisma ORM -->
    <rect x="300" y="590" width="150" height="100" rx="10" class="database"/>
    <text x="375" y="615" text-anchor="middle" class="text">Prisma ORM</text>
    <text x="375" y="635" text-anchor="middle" class="small-text">• 数据模型</text>
    <text x="375" y="650" text-anchor="middle" class="small-text">• 查询构建</text>
    <text x="375" y="665" text-anchor="middle" class="small-text">• 类型安全</text>
    <text x="375" y="680" text-anchor="middle" class="small-text">• 迁移管理</text>
  </g>
  
  <!-- 外部服务 -->
  <g id="external-layer">
    <text x="700" y="80" class="subtitle">外部服务 (External)</text>
    
    <!-- Dify 平台 -->
    <rect x="650" y="100" width="180" height="100" rx="10" class="external"/>
    <text x="740" y="125" text-anchor="middle" class="text">Dify Platform</text>
    <text x="740" y="145" text-anchor="middle" class="small-text">• 工作流引擎</text>
    <text x="740" y="160" text-anchor="middle" class="small-text">• AI 模型调用</text>
    <text x="740" y="175" text-anchor="middle" class="small-text">• 流式响应</text>
    <text x="740" y="190" text-anchor="middle" class="small-text">• 知识库集成</text>
    
    <!-- 知识库 -->
    <rect x="880" y="100" width="150" height="100" rx="10" class="external"/>
    <text x="955" y="125" text-anchor="middle" class="text">Knowledge Base</text>
    <text x="955" y="145" text-anchor="middle" class="small-text">• 文档存储</text>
    <text x="955" y="160" text-anchor="middle" class="small-text">• 向量检索</text>
    <text x="955" y="175" text-anchor="middle" class="small-text">• 语义搜索</text>
    <text x="955" y="190" text-anchor="middle" class="small-text">• 内容管理</text>
  </g>
  
  <!-- 数据流箭头 -->
  <g id="data-flows">
    <!-- 前端到后端 -->
    <line x1="250" y1="140" x2="300" y2="140" class="arrow"/>
    <line x1="375" y1="180" x2="375" y2="270" class="arrow"/>
    
    <!-- 后端内部流转 -->
    <line x1="200" y1="310" x2="250" y2="310" class="arrow"/>
    <line x1="370" y1="310" x2="420" y2="310" class="arrow"/>
    
    <!-- 服务层调用 -->
    <line x1="495" y1="350" x2="495" y2="440" class="arrow"/>
    <line x1="480" y1="470" x2="500" y2="470" class="arrow"/>
    
    <!-- 数据库访问 -->
    <line x1="375" y1="500" x2="375" y2="590" class="arrow"/>
    <line x1="300" y1="640" x2="250" y2="640" class="arrow"/>
    
    <!-- 外部服务调用 -->
    <line x1="565" y1="440" x2="565" y2="350" class="arrow"/>
    <line x1="570" y1="310" x2="650" y2="150" class="arrow"/>
    <line x1="830" y1="150" x2="880" y2="150" class="arrow"/>
  </g>
  
  <!-- 数据流说明 -->
  <g id="data-flow-legend">
    <text x="700" y="300" class="subtitle">数据流说明</text>
    
    <rect x="650" y="320" width="400" height="200" rx="10" fill="#ecf0f1" stroke="#bdc3c7" stroke-width="1"/>
    
    <text x="670" y="345" class="text">1. 用户输入 → 前端验证 → API请求</text>
    <text x="670" y="365" class="text">2. 路由处理 → 字段映射 → 数据验证</text>
    <text x="670" y="385" class="text">3. 任务创建 → 工作流调用 → Dify执行</text>
    <text x="670" y="405" class="text">4. 流式响应 → 结果解析 → 数据存储</text>
    <text x="670" y="425" class="text">5. 状态更新 → 内容生成 → 响应返回</text>
    
    <text x="670" y="455" class="small-text">支持的工作流类型：</text>
    <text x="670" y="475" class="small-text">• speech_writing (演讲稿撰写)</text>
    <text x="670" y="490" class="small-text">• ip_mining (IP挖掘)</text>
    <text x="670" y="505" class="small-text">• tech_article (技术通稿)</text>
  </g>
  
  <!-- 性能指标 -->
  <g id="performance-metrics">
    <text x="700" y="580" class="subtitle">性能指标</text>
    
    <rect x="650" y="600" width="400" height="150" rx="10" fill="#f8f9fa" stroke="#dee2e6" stroke-width="1"/>
    
    <text x="670" y="625" class="text">• 任务处理时间: 30-120秒</text>
    <text x="670" y="645" class="text">• 并发任务数: 最大10个</text>
    <text x="670" y="665" class="text">• API响应时间: &lt;500ms</text>
    <text x="670" y="685" class="text">• 数据库查询: &lt;100ms</text>
    <text x="670" y="705" class="text">• 缓存命中率: &gt;80%</text>
    <text x="670" y="725" class="text">• 系统可用性: &gt;99.5%</text>
  </g>
  
</svg>